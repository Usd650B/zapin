{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged,updateProfile}from'firebase/auth';import{auth,db}from'../firebase';import{doc,setDoc,getDoc}from'firebase/firestore';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function useAuth(){return useContext(AuthContext);}export function AuthProvider(_ref){let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[userType,setUserType]=useState(null);const[loading,setLoading]=useState(true);async function signup(email,password,type){console.log('Attempting signup for:',email);try{const result=await createUserWithEmailAndPassword(auth,email,password);console.log('Firebase Auth user created:',result.user.uid);const user=result.user;// Set display name\nconsole.log('Updating profile...');await updateProfile(user,{displayName:email.split('@')[0]});// Store user type in Firestore\nconsole.log('Saving to Firestore users collection...');await setDoc(doc(db,'users',user.uid),{email,type,createdAt:new Date().toISOString()});console.log('Firestore user doc created');setUserType(type);return result;}catch(err){console.error('Signup error details:',err);throw err;}}async function login(email,password,type){const result=await signInWithEmailAndPassword(auth,email,password);const user=result.user;// Fetch user type from Firestore\nconst userDoc=await getDoc(doc(db,'users',user.uid));if(userDoc.exists()){const data=userDoc.data();setUserType(data.type);}else{// Fallback or set type if missing\nsetUserType(type);}return result;}function logout(){setUserType(null);return signOut(auth);}function updateUserType(type){setUserType(type);if(currentUser){setDoc(doc(db,'users',currentUser.uid),{type},{merge:true});}}useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async user=>{setCurrentUser(user);if(user){// Fetch user type on auth state change\nconst userDoc=await getDoc(doc(db,'users',user.uid));if(userDoc.exists()){setUserType(userDoc.data().type);}}setLoading(false);});return unsubscribe;},[]);const value={currentUser,userType,signup,login,logout,updateUserType};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","onAuthStateChanged","updateProfile","auth","db","doc","setDoc","getDoc","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","userType","setUserType","loading","setLoading","signup","email","password","type","console","log","result","user","uid","displayName","split","createdAt","Date","toISOString","err","error","login","userDoc","exists","data","logout","updateUserType","merge","unsubscribe","value","Provider"],"sources":["C:/Users/mabessa/CascadeProjects/windsurf-project-10/zapin/CascadeProjects/windsurf-project/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport {\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  signOut,\n  onAuthStateChanged,\n  updateProfile\n} from 'firebase/auth';\nimport { auth, db } from '../firebase';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [userType, setUserType] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  async function signup(email, password, type) {\n    console.log('Attempting signup for:', email);\n    try {\n      const result = await createUserWithEmailAndPassword(auth, email, password);\n      console.log('Firebase Auth user created:', result.user.uid);\n      const user = result.user;\n\n      // Set display name\n      console.log('Updating profile...');\n      await updateProfile(user, {\n        displayName: email.split('@')[0]\n      });\n\n      // Store user type in Firestore\n      console.log('Saving to Firestore users collection...');\n      await setDoc(doc(db, 'users', user.uid), {\n        email,\n        type,\n        createdAt: new Date().toISOString()\n      });\n      console.log('Firestore user doc created');\n\n      setUserType(type);\n      return result;\n    } catch (err) {\n      console.error('Signup error details:', err);\n      throw err;\n    }\n  }\n\n  async function login(email, password, type) {\n    const result = await signInWithEmailAndPassword(auth, email, password);\n    const user = result.user;\n\n    // Fetch user type from Firestore\n    const userDoc = await getDoc(doc(db, 'users', user.uid));\n    if (userDoc.exists()) {\n      const data = userDoc.data();\n      setUserType(data.type);\n    } else {\n      // Fallback or set type if missing\n      setUserType(type);\n    }\n\n    return result;\n  }\n\n  function logout() {\n    setUserType(null);\n    return signOut(auth);\n  }\n\n  function updateUserType(type) {\n    setUserType(type);\n    if (currentUser) {\n      setDoc(doc(db, 'users', currentUser.uid), { type }, { merge: true });\n    }\n  }\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      setCurrentUser(user);\n      if (user) {\n        // Fetch user type on auth state change\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\n        if (userDoc.exists()) {\n          setUserType(userDoc.data().type);\n        }\n      }\n      setLoading(false);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  const value = {\n    currentUser,\n    userType,\n    signup,\n    login,\n    logout,\n    updateUserType\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}